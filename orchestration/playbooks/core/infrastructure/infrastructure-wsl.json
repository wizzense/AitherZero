{
  "metadata": {
    "name": "infrastructure-wsl",
    "description": "WSL2-based development environment with Docker integration",
    "version": "2.0.0",
    "category": "infrastructure",
    "author": "AitherZero Infrastructure Team",
    "tags": ["wsl2", "linux", "docker", "development", "windows"],
    "estimatedDuration": "15-25 minutes",
    "lastUpdated": "2025-11-02T06:00:00Z"
  },
  "requirements": {
    "minimumPowerShellVersion": "7.0",
    "requiredModules": [],
    "requiredTools": [],
    "platforms": ["Windows"],
    "permissions": ["Administrator"]
  },
  "orchestration": {
    "defaultVariables": {
      "wslDistribution": "Ubuntu",
      "installDocker": true,
      "dockerIntegration": true,
      "setupDevEnvironment": true
    },
    "profiles": {
      "minimal": {
        "description": "WSL2 only, no Docker",
        "variables": {
          "installDocker": false,
          "setupDevEnvironment": false
        }
      },
      "development": {
        "description": "Full development setup with Docker",
        "variables": {
          "installDocker": true,
          "dockerIntegration": true,
          "setupDevEnvironment": true
        }
      },
      "docker-focused": {
        "description": "Optimized for container development",
        "variables": {
          "installDocker": true,
          "dockerIntegration": true,
          "setupDevEnvironment": false
        }
      }
    },
    "stages": [
      {
        "name": "System Prerequisites",
        "description": "Configure Windows for WSL2",
        "sequences": ["0100"],
        "variables": {
          "EnableWSL": true,
          "EnableVirtualization": true
        },
        "continueOnError": false,
        "timeout": 300
      },
      {
        "name": "Install WSL2",
        "description": "Install and configure WSL2",
        "sequences": ["0106"],
        "variables": {
          "Distribution": "{{wslDistribution}}",
          "SetDefault": true,
          "UpdateKernel": true
        },
        "continueOnError": false,
        "timeout": 900,
        "retries": 1
      },
      {
        "name": "Install Docker",
        "description": "Install Docker Desktop with WSL2 backend",
        "sequences": ["0208"],
        "condition": "{{installDocker}}",
        "variables": {
          "WSL2Backend": true,
          "DockerIntegration": "{{dockerIntegration}}"
        },
        "continueOnError": true,
        "timeout": 600
      },
      {
        "name": "Setup Dev Environment",
        "description": "Configure development tools in WSL",
        "sequences": ["0207", "0201"],
        "condition": "{{setupDevEnvironment}}",
        "variables": {
          "InstallGit": true,
          "InstallNode": true,
          "WSLContext": true
        },
        "continueOnError": true,
        "timeout": 600
      },
      {
        "name": "Environment Validation",
        "description": "Validate WSL2 and Docker setup",
        "sequences": ["0500"],
        "variables": {
          "CheckWSL": true,
          "CheckDocker": "{{installDocker}}",
          "CheckLinuxTools": "{{setupDevEnvironment}}"
        },
        "continueOnError": false,
        "timeout": 120
      }
    ]
  },
  "validation": {
    "preConditions": [
      {
        "name": "Windows Platform",
        "condition": "$IsWindows",
        "message": "WSL2 is only available on Windows"
      },
      {
        "name": "Administrator Rights",
        "condition": "([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)",
        "message": "Administrator privileges are required for WSL2 installation"
      },
      {
        "name": "Windows Version",
        "condition": "[System.Environment]::OSVersion.Version.Build -ge 19041",
        "message": "Windows 10 version 2004 or higher is required for WSL2"
      }
    ],
    "postConditions": [
      {
        "name": "WSL2 Installed",
        "condition": "wsl --status | Select-String 'WSL 2'",
        "message": "WSL2 should be installed and configured"
      },
      {
        "name": "Docker Available",
        "condition": "!{{installDocker}} -or (Get-Command docker -ErrorAction SilentlyContinue)",
        "message": "Docker should be available if installation was requested"
      }
    ]
  },
  "notifications": {
    "onStart": {
      "message": "üêß Setting up WSL2 development environment...",
      "level": "Information",
      "channels": ["console", "log"]
    },
    "onSuccess": {
      "message": "üéâ WSL2 environment ready! Linux development at your fingertips.",
      "level": "Success",
      "channels": ["console", "log"]
    },
    "onFailure": {
      "message": "üí• WSL2 setup failed. System may require restart.",
      "level": "Error",
      "channels": ["console", "log"],
      "includeFailures": true
    },
    "onRebootRequired": {
      "message": "üîÑ System restart required to complete WSL2 installation",
      "level": "Warning",
      "channels": ["console", "log"]
    }
  },
  "reporting": {
    "enabled": true,
    "formats": ["Console", "JSON", "HTML"],
    "outputPath": "./reports/infrastructure",
    "includeMetrics": true,
    "includeLogs": true
  },
  "postActions": [
    {
      "description": "Display WSL information",
      "type": "script",
      "inline": "Write-Host '\\nüêß WSL2 Information:' -ForegroundColor Cyan; wsl --list --verbose 2>$null | Write-Host"
    },
    {
      "description": "Docker status",
      "type": "conditional",
      "condition": "{{installDocker}}",
      "action": {
        "type": "script",
        "inline": "if (Get-Command docker -ErrorAction SilentlyContinue) { Write-Host '\\nüê≥ Docker Status:' -ForegroundColor Cyan; docker version --format '  Version: {{.Server.Version}}' 2>$null }"
      }
    },
    {
      "description": "Next steps",
      "type": "script",
      "inline": "Write-Host '\\nüí° Next Steps:' -ForegroundColor Yellow; Write-Host '  - Access WSL: wsl -d {{wslDistribution}}'; Write-Host '  - VS Code integration: code . (in WSL terminal)'; Write-Host '  - Docker commands work from PowerShell or WSL'; if ($env:RESTART_REQUIRED) { Write-Host '  ‚ö†Ô∏è  RESTART REQUIRED to complete setup' -ForegroundColor Red }"
    }
  ],
  "rebootHandling": {
    "checkRequired": true,
    "promptUser": true,
    "saveContext": true
  }
}
