#!/usr/bin/env pwsh
# Robust script root detection
$root = $PSScriptRoot
if (-not $root) {
    # Fallback: try to get directory from MyInvocation
    if ($MyInvocation.MyCommand.Path) {
        $root = Split-Path -Parent $MyInvocation.MyCommand.Path
    } else {
        # Final fallback: current directory (assuming we're in AitherZero root)
        $root = Get-Location
    }
}

# Ensure we have the correct paths
$moduleManifest = Join-Path $root "AitherZero.psd1"
$azScript = Join-Path $root "az.ps1"

if (-not $env:AITHERZERO_INITIALIZED) {
    if (Test-Path $moduleManifest) {
        Import-Module $moduleManifest -Force -Global
    } else {
        Write-Error "AitherZero module manifest not found at: $moduleManifest"
        exit 1
    }
}

if (Test-Path $azScript) {
    & $azScript $args
} else {
    Write-Error "az.ps1 script not found at: $azScript"
    exit 1
}
